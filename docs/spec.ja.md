# 要件定義書: LLMeta

## 1. 概要

本ドキュメントは、WebXR メタバース体験プロジェクト「LLMeta」の要件を定義するものである。LLMeta は、ユーザーが共有の 3D 空間でリアルタイムに交流し、AI によるコミュニケーション支援を受けられる軽量な Web アプリケーションである。

## 2. プロジェクトの目的

- **リアルタイムコミュニケーション:** 最大 10 名のユーザーが、空間オーディオを備えた 3D 空間で円滑に音声会話できる環境を提供する。
- **AI による支援:** 各ユーザーにパーソナライズされた AI エージェントを付与し、会話の要約、解説、関連画像の自動生成など、コミュニケーションを豊かにする機能を提供する。
- **クロスプラットフォーム:** デスクトップブラウザおよび XR デバイスからシームレスにアクセス可能な体験を実現する。

## 3. 機能要件

### 3.1. ユーザー管理機能

- **認証:** ユーザーはアカウントを作成し、ログインできる。認証基盤には Supabase を利用する。
- **プロフィール:** ユーザーはメタバース内で使用する表示名やアバターを設定できる。

### 3.2. メタバースコア機能

- **ルーム:** ユーザーはセッション（ルーム）を作成、または既存のルームに参加できる。
- **3D 空間:** ユーザーは 3D でレンダリングされた空間内をアバターとして自由に移動できる。
- **リアルタイム同期:** ユーザーのアバターの位置や動きは、Colyseus サーバーを介してルーム内の全ユーザーにリアルタイムで同期される。
- **空間オーディオ:** ユーザー間の距離に応じて音声の聞こえ方が変わる空間オーディオを実現する。メディア配信には LiveKit SFU を利用する。

### 3.3. AI サポーター機能

- **パーソナル AI エージェント:** 各ユーザーには、1 対 1 で紐づく AI エージェントが割り当てられる。
- **リアルタイム音声認識:** ユーザーの発言は、Whisper モデルを用いてリアルタイムでテキストに変換される。
- **プライベートサポート:** AI エージェントは、ユーザー個人にのみ見える形で、会話の要約や用語の解説をテキストで提示する。
- **パブリックサポート（画像生成）:** AI エージェントは、会話の文脈に基づいて画像を自動生成し、ルーム内の全ユーザーが見える形で共有する。

## 4. 非機能要件

### 4.1. パフォーマンス

- **低遅延:** ユーザー間の音声および状態同期の遅延を最小限に抑え、自然なコミュニケーションを阻害しないこと。
- **レンダリング:** XR デバイスでも安定したフレームレートを維持できるよう、3D アセットや描画処理を最適化すること。

### 4.2. スケーラビリティ

- システムは、ユーザー数やルーム数の増加に応じてスケール可能な構成であること。AI エージェントはユーザーごとに独立して動作するスケーラブルな設計とする。

### 4.3. セキュリティ

- ユーザー間の通信は暗号化されること。
- ルームへの参加は、Supabase から発行される JWT（JSON Web Token）による認証を必須とすること。

### 4.4. 開発・運用

- **技術スタック:**
  - **フロントエンド:** Next.js, TypeScript, React Three Fiber, Tailwind CSS
  - **バックエンド:**
    - **マルチプレイヤー:** Colyseus
    - **メディア:** LiveKit
    - **認証/DB:** Supabase
    - **AI サービス:** FastAPI, Whisper, LLM, Image Generation Model
- **保守性:** バックエンドは責務ごとにマイクロサービス化されており、各サービスは独立して開発・デプロイが可能であること。

## 5. システム構成

システムは、フロントエンド、バックエンドサービス、AI エージェントの 3 層で構成される。詳細は `system-architecture.md` の Mermaid 図に記載の通りとする。ユーザー認証、状態同期、メディア配信、AI 処理はそれぞれ独立したサービスが担い、疎結合な連携を実現する。
