# ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ä»•æ§˜æ›¸ (MVP)

ç‰ˆæ•°: v0.2  
ä½œæˆæ—¥: 2025-09-25  
å‚ç…§å…ƒ: `spec.md` (è¦ä»¶å®šç¾© v0.1)

---

## 0. æœ€æ–°å®Ÿè£…çŠ¶æ³ã‚µãƒãƒª (2025-09-25)

| é …ç›®                       | çŠ¶æ…‹      | ãƒ¡ãƒ¢                                                           |
| -------------------------- | --------- | -------------------------------------------------------------- |
| Colyseus é€£æº              | âœ… å®Œäº†   | `use-colyseus` çµŒç”±ã§ `MyRoom` ã«æ¥ç¶šã€é ­éƒ¨/æ‰‹ãƒãƒ¼ã‚ºã‚’é…ä¿¡ä¸­ã€‚ |
| XR å…¥åŠ›ãƒ»æ‰‹ãƒãƒ¼ã‚ºåŒæœŸ      | ğŸ”„ é€²è¡Œä¸­ | XR ãƒˆã‚°ãƒ«ã¨æ‰‹ãƒãƒ¼ã‚ºé€ä¿¡ã¯å®Ÿè£…æ¸ˆã¿ã€ã‚¢ãƒã‚¿ãƒ¼ãƒ¢ãƒ‡ãƒ«çµ±åˆã¯æœªå®Œã€‚  |
| ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ç§»å‹• + è£œé–“    | âœ… å®Œäº†   | `SimpleCharacter` + è£œé–“ãƒ•ãƒƒã‚¯ã§ãƒªãƒ¢ãƒ¼ãƒˆè¡¨ç¤ºã‚’æ»‘ã‚‰ã‹ã«æ›´æ–°ã€‚   |
| LiveKit ç©ºé–“éŸ³å£°           | â³ æœªç€æ‰‹ | ç¾çŠ¶ã¯ WebRTC/ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªçµ±åˆãªã—ã€‚                             |
| AI ãƒ‘ãƒãƒ« / Gateway        | â³ æœªç€æ‰‹ | UIãƒ»ã‚µãƒ¼ãƒä¸¡æ–¹ã§æœªå®Ÿè£…ã€‚                                       |
| å†æ¥ç¶šåˆ¶å¾¡ / ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ UI | â³ æœªç€æ‰‹ | åˆ‡æ–­ãƒªãƒˆãƒ©ã‚¤ãƒ»æ¥ç¶šã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ã¯æœªå®Ÿè£…ã€‚                       |
| VRM ä½“é¨“ãƒšãƒ¼ã‚¸             | âœ… å®Œäº†   | `/vrm` ã§ VRM èª­ã¿è¾¼ã¿ãƒ»è¡¨æƒ…/ã‚¢ãƒ‹ãƒ¡èª¿æ•´ãŒå¯èƒ½ã€‚                |

â€» æœ¬ç¨¿ã®ä»¥é™ç¯€ã§ã¯ã€é€²æ—æ¸ˆã¿éƒ¨åˆ†ã¨æœªå®Ÿè£…éƒ¨åˆ†ã®åŒæ–¹ã‚’æ˜è¨˜ã—ã€å°†æ¥æ‹¡å¼µã®è¨­è¨ˆæ„å›³ã‚’ç¶­æŒã™ã‚‹ã€‚

## 1. ç›®çš„

è¦ä»¶å®šç¾© (FR/NFR) ã‚’å®Ÿè£…ã¸æ­£ç¢ºã«ãƒ–ãƒªãƒƒã‚¸ã™ã‚‹ãŸã‚ã«ã€MVP ãƒ•ã‚§ãƒ¼ã‚ºã§æ¡ç”¨ã™ã‚‹è«–ç†/ç‰©ç†æ§‹æˆã€ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã€åŒæœŸ/AI/éŸ³å£°ã®æŠ€è¡“çš„ä»•æ§˜ã€æ€§èƒ½/å“è³ªè¨­è¨ˆã¨æ‹¡å¼µæŒ‡é‡ã‚’æ˜ç¤ºã™ã‚‹ã€‚ã‚³ãƒ¼ãƒ‰å®Ÿè£…å‰ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŠã‚ˆã³å¤‰æ›´çµ±åˆ¶ã®åŸºç¤è³‡æ–™ã¨ã™ã‚‹ã€‚

## 2. ãƒã‚¤ãƒ¬ãƒ™ãƒ«æ§‹æˆ

```
[Browser Client (Next.js / React / Three.js / WebXR)]
   â”œâ”€ UIå±¤ (å‚åŠ ãƒ•ã‚©ãƒ¼ãƒ , HUD, AIãƒ‘ãƒãƒ«)
   â”œâ”€ 3Dè¡¨ç¤ºå±¤ (Scene Graph, Avatar, Camera Rig)
   â”œâ”€ XRå…¥åŠ›å±¤ (VR Pose, Controllers, Gestures)
   â”œâ”€ åŒæœŸåˆ¶å¾¡å±¤ (State Buffer, Interpolation, Rate Control)
   â”œâ”€ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å±¤
   â”‚    â”œâ”€ Colyseus Client (WS)
   â”‚    â””â”€ LiveKit Client (WebRTC: éŸ³å£°)
   â””â”€ AIãƒ‘ãƒãƒ«ãƒ­ã‚¸ãƒƒã‚¯ (API å‘¼å‡ºã—)

[Application Server (Node.js / Colyseus)]
   â”œâ”€ Roomç®¡ç† (MyRoom)
   â”œâ”€ State Schema (Players, Gestures, Metadata)
   â”œâ”€ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç† (ä½ç½®/å›è»¢/ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼/Event)
   â”œâ”€ å†æ¥ç¶šãƒãƒ³ãƒ‰ãƒ© / ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€æ™‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥
   â”œâ”€ AI Gateway Proxy (ç¿»è¨³/è¦ç´„/ç”»åƒç”Ÿæˆ/ä¼šè©±è£œåŠ©)
   â””â”€ ãƒ­ã‚°/è¨ˆæ¸¬ (æœ€å°é™)

[LiveKit SFU]
   â””â”€ éŸ³å£°ãƒˆãƒ©ãƒƒã‚¯ (ä½ç½®ãƒ™ãƒ¼ã‚¹å®šä½ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ WebAudio + Panner)

[AI Providers]
   â”œâ”€ Translation API
   â”œâ”€ Summarization LLM
   â”œâ”€ Image Generation
   â””â”€ Prompt Assist (LLM)

> ç¾çŠ¶ (v0.2) ã§ã¯ LiveKit / AI Provider ã¨ã®æ¥ç¶šã¯æœªå®Ÿè£…ã§ã‚ã‚Šã€å›³å†…ã®è©²å½“ãƒ–ãƒ­ãƒƒã‚¯ã¯è¨ˆç”»æ®µéšã‚’ç¤ºã™ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ Colyseus ã‚’é€šã˜ãŸçŠ¶æ…‹åŒæœŸã®ã¿ã‚’è¡Œã†ã€‚
```

## 3. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè©³ç´°

| å±¤           | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ        | ä¸»è²¬å‹™                                       | FR/NFR é–¢é€£        | å®Ÿè£…çŠ¶æ³ (2025-09-25)                           |
| ------------ | --------------------- | -------------------------------------------- | ------------------ | ----------------------------------------------- |
| ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ | UI ãƒ•ã‚©ãƒ¼ãƒ            | ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ å…¥åŠ›/ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³              | FR-01,02           | â³ æœªç€æ‰‹ â€” è‡ªå‹•å‚åŠ ã§ sessionId ã‚’ä»®è¡¨ç¤ºä¸­     |
|              | Avatar Manager        | ãƒ¢ãƒ‡ãƒ«ãƒ­ãƒ¼ãƒ‰ / ã‚¢ãƒ‹ãƒ¡é©ç”¨ / ãƒãƒ¼ã‚ºåæ˜        | FR-03~07           | ğŸ”„ éƒ¨åˆ†å®Ÿè£… â€” `/vrm` ã§å®Œäº†ã€ä½“é¨“ãƒ«ãƒ¼ãƒ çµ±åˆæœªå®Œ |
|              | Network Sync Module   | é€ä¿¡é »åº¦åˆ¶å¾¡ / ãƒ‘ã‚±ãƒƒãƒˆç”Ÿæˆ / è£œé–“ãƒãƒƒãƒ•ã‚¡   | FR-03,04 / NFR-P01 | âœ… å®Ÿè£…æ¸ˆ â€” ãƒãƒ¼ã‚ºé€ä¿¡ + è£œé–“ãƒ•ãƒƒã‚¯ç¨¼åƒ         |
|              | XR Input Adapter      | WebXR Pose å–å¾— / Fallback ã‚«ãƒ¡ãƒ©æ“ä½œ        | FR-05,06           | ğŸ”„ éƒ¨åˆ†å®Ÿè£… â€” XR å…¥åŠ›/æ‰‹ãƒãƒ¼ã‚ºé€ä¿¡ã¯ç¨¼åƒ        |
|              | Spatial Audio Adapter | LiveKit éŸ³å£°ã‚’ä½ç½®æ›´æ–°ã§ PannerNode ã«åæ˜    | FR-08,09 / NFR-U01 | â³ æœªç€æ‰‹ â€” ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå‡¦ç†ãªã—                  |
|              | AI Panel              | ç¿»è¨³/è¦ç´„ UI/ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°/ã‚¨ãƒ©ãƒ¼è¡¨ç¤º         | FR-11~14           | â³ æœªç€æ‰‹                                       |
| ã‚µãƒ¼ãƒ       | Colyseus Room         | å…¥é€€å®¤/æœ€å¤§äººæ•°åˆ¶é™/ã‚¤ãƒ™ãƒ³ãƒˆãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ | FR-01,10           | âœ… å®Ÿè£…æ¸ˆ â€” `maxClients=10` ã§ç¨¼åƒ              |
|              | State Schema          | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ®ç™ºçŠ¶æ…‹ä¿æŒ (å†æ¥ç¶šæ™‚å†é€)        | FR-03~07           | âœ… å®Ÿè£…æ¸ˆ â€” é ­éƒ¨/ä¸¡æ‰‹åº§æ¨™ã‚’ä¿æŒ                 |
|              | AI Gateway            | ãƒ™ãƒ³ãƒ€ãƒ¼å·®ç•°å¸å / ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ / ãƒªãƒˆãƒ©ã‚¤   | FR-11~14           | â³ æœªç€æ‰‹                                       |
|              | Connection Manager    | å†æ¥ç¶šãƒ­ã‚¸ãƒƒã‚¯ / ã‚»ãƒƒã‚·ãƒ§ãƒ³å¾©å…ƒ              | FR-16,17 / NFR-R01 | â³ æœªç€æ‰‹ â€” Colyseus æ—¢å®šæŒ™å‹•ã®ã¿               |
| å¤–éƒ¨         | LiveKit               | éŸ³å£° SFU                                     | FR-08,09           | â³ æœªæ¥ç¶š                                       |
| å¤–éƒ¨         | AI APIs               | ç¿»è¨³/è¦ç´„/ç”»åƒ/ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ                | FR-11~14           | â³ æœªæ¥ç¶š                                       |

## 4. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ« (å®Ÿè£…ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹æ¡ˆ)

TypeScript ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ (ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå†… / ã‚µãƒ¼ãƒé€å—ä¿¡ DTO æ¦‚ç•¥):

```ts
// é€ä¿¡é »åº¦: pose ~20Hz (èª¿æ•´å¯èƒ½)
interface PlayerPoseUpdate {
  t: number; // ms timestamp (client monotonic)
  id: string; // playerId
  p: [number, number, number]; // position (é‡å­åŒ–å‰float)
  r: [number, number, number, number]; // quaternion
  head?: {
    p: [number, number, number];
    r: [number, number, number, number];
    h?: number;
  };
  hands?: { l?: Pose; r?: Pose };
}
interface Pose {
  p: [number, number, number];
  r: [number, number, number, number];
  s?: number;
}

// ã‚¤ãƒ™ãƒ³ãƒˆ (ä½é »åº¦)
interface GestureEvent {
  id: string;
  gesture: number;
  ts: number;
}
interface JoinAck {
  selfId: string;
  players: PlayerSnapshot[];
}
interface PlayerSnapshot {
  id: string;
  nickname: string;
  pose?: PlayerPoseUpdate;
  gesture?: number;
}

// AI é–¢é€£
interface AIRequest {
  reqId: string;
  type: "translate" | "summary" | "image" | "assist";
  payload: any;
}
interface AIResponse {
  reqId: string;
  ok: boolean;
  type: AIRequest["type"];
  data?: any;
  error?: string;
  elapsedMs: number;
}
```

### 4.1 é‡å­åŒ– (å°†æ¥æ‹¡å¼µãƒ•ãƒƒã‚¯)

MVP ã§ã¯ç”Ÿ float32 ã‚’ JSON åŒ– â†’ ã‚µã‚¤ã‚ºæœ€é©åŒ–å„ªå…ˆåº¦: ä¸­ã€‚P2 ã§ Int16 é‡å­åŒ– (`[-20,20]` æ­£è¦åŒ– â†’`Int16`) è¿½åŠ äºˆå®šã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹äº’æ›ã®ãŸã‚ `version` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ ä½™åœ°ã‚’ç¢ºä¿ (æœªé€ä¿¡æ™‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ=0)ã€‚

## 5. é€šä¿¡ãƒ—ãƒ­ãƒˆã‚³ãƒ« & æ›´æ–°æˆ¦ç•¥

| é …ç›®         | æ–¹å¼                              | é »åº¦ / ãƒˆãƒªã‚¬                        | ä¿¡é ¼æ€§         | å‚™è€ƒ                               |
| ------------ | --------------------------------- | ------------------------------------ | -------------- | ---------------------------------- |
| PoseUpdate   | Colyseus broadcast (patch)        | 20Hz ç›®æ¨™ / å‹•ãç„¡æ™‚ã‚¹ãƒ­ãƒƒãƒˆãƒ« (5Hz) | ä¸è¦(æœ€æ–°å„ªå…ˆ) | Sequence ç•ªå· `seq` ä»˜ä¸ã§é…å»¶åˆ¤å®š |
| GestureEvent | Colyseus message                  | Event                                | At-least-once  | client ã§é‡è¤‡é™¤å» (gestureId + ts) |
| Join / Leave | Room lifecycle                    | Event                                | å¿…é ˆ           | 10 äººåˆ¶é™è¶…éæ™‚ `JoinReject`       |
| AIRequest    | HTTP (Server â†’ Provider) / WS Ack | User æ“ä½œ                            | å¿…é ˆ           | ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ/ãƒªãƒˆãƒ©ã‚¤åˆ¶å¾¡          |
| AIResponse   | WS to client                      | Provider å®Œäº†                        | å¿…é ˆ           | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ reqId çªåˆ          |

ç¾çŠ¶ã¯ `PoseUpdate` ã¨å…¥é€€å®¤ã‚¤ãƒ™ãƒ³ãƒˆã®ã¿ãŒå®Ÿé‹ç”¨ã•ã‚Œã¦ãŠã‚Šã€AI ç³»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯æœªä½¿ç”¨ã€‚

### 5.1 ãƒ¬ãƒ¼ãƒˆåˆ¶å¾¡

- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆé€ä¿¡ã‚­ãƒ¥ãƒ¼: 16ms ã‚¿ã‚¤ãƒ ã‚¹ãƒ©ã‚¤ã‚¹å†…æœ€æ–°ãƒãƒ¼ã‚ºã®ã¿ä¿æŒ (å¤ã„ã‚‚ã®ç ´æ£„)ã€‚
- ã‚µãƒ¼ãƒå´: æœ€çµ‚å—ä¿¡æ™‚åˆ»å·®åˆ† > 150ms ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯è£œé–“åœæ­¢ â†’ ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆæ‰±ã„ã€‚

### 5.2 è£œé–“ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

```
Receive pose(t0) & pose(t1) â†’ renderTime = now - interpolationDelay( ~50ms )
if renderTime between t0..t1: Lerp position / Slerp rotation
else if renderTime > t1 + grace(100ms): switch to extrapolation (velocity= (p1-p0)/(t1-t0)) up to 250ms cap.
```

## 6. ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ (Mermaid)

### 6.1 å‚åŠ 

```mermaid
sequenceDiagram
  participant U as User Browser
  participant C as Colyseus Server
  participant L as LiveKit
  U->>C: JoinRoom(nickname)
  C-->>U: JoinAck(selfId, players)
  par Audio
    U->>L: Join LiveKit Room (token)
    L-->>U: Audio Streams
  and State
    loop ~20Hz
      U->>C: PoseUpdate
      C-->>U: Patch (others' pose)
    end
  end
```

### 6.2 AI ç¿»è¨³

```mermaid
sequenceDiagram
  participant U as Client
  participant C as Server
  participant AI as Translation API
  U->>C: AIRequest(reqId, translate)
  C->>AI: REST Request
  AI-->>C: Result / Error
  C-->>U: AIResponse(reqId, data)
```

### 6.3 å†æ¥ç¶š

```mermaid
sequenceDiagram
  participant U as Client
  participant C as Server
  Note over U,C: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ–­ <10s
  U->>C: Reconnect(sessionToken)
  C-->>U: RejoinAck (current players + buffered state)
```

## 7. ç©ºé–“éŸ³å£°è¨­è¨ˆ

> å®Ÿè£…çŠ¶æ³: LiveKit é€£æºã¨ PannerNode æ›´æ–°ã¯æœªç€æ‰‹ã€‚ä»¥ä¸‹ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯è¨­è¨ˆæŒ‡é‡ã¨ã—ã¦ç¶­æŒã™ã‚‹ã€‚

| é …ç›®            | å€¤(åˆæœŸ)          | èª¿æ•´ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿             |
| --------------- | ----------------- | -------------------------- |
| refDistance     | 1.0               | UI è¨­å®š (å°†æ¥)             |
| maxDistance     | 25.0              | env config                 |
| rolloffFactor   | 1.0 (ç·šå½¢ â†’ èª¿æ•´) | 0.5~2.0                    |
| coneInner/Outer | 360 / 360         | å°†æ¥ head orientation åˆ©ç”¨ |

æ›´æ–°: `requestAnimationFrame` æ¯ã« listener/å„ PannerNode ã® position/ orientation æ›´æ–°ã€‚éŸ³é‡ UI ãƒŸãƒ¥ãƒ¼ãƒˆæ™‚ã¯ GainNode ã§ 0ã€‚è·é›¢ãƒ¢ãƒ‡ãƒ«æ¤œè¨¼ (5m ã§ <=40%) ã‚’ AC-03 ã¨ã—ã¦è¨ˆæ¸¬ã‚¹ã‚¯ãƒªãƒ—ãƒˆç”¨æ„äºˆå®šã€‚

## 8. AI Gateway ä»•æ§˜

> å®Ÿè£…çŠ¶æ³: ã‚µãƒ¼ãƒãƒ¼å´ã® Gateway æŠ½è±¡ãƒ»å¤–éƒ¨ API å‘¼å‡ºã—ã¯æœªç€æ‰‹ã€‚UI ã‚‚æœªå®Ÿè£…ã€‚

| æ©Ÿèƒ½      | API æŠ½è±¡ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹        | Timeout | Retry | ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æœ€å°åŒ–     |
| --------- | ----------------------------- | ------- | ----- | -------------------- |
| translate | `translate(text, src, dst)`   | 8s      | 1     | text é•· <= 2k chars  |
| summary   | `summarize(recentMessages[])` | 10s     | 1     | ç›´è¿‘ N(=20) ä»¶ã®ã¿   |
| image     | `generateImage(prompt)`       | 25s     | 1     | prompt sanitize      |
| assist    | `assist(context)`             | 8s      | 1     | context ãƒˆãƒ¼ã‚¯ãƒ³å‰Šæ¸› |

ã‚¨ãƒ©ãƒ¼ã‚«ãƒ†ã‚´ãƒª: `TIMEOUT` / `UPSTREAM_ERROR` / `RATE_LIMIT` / `INVALID_INPUT` / `SANITIZE_BLOCK`. UI ã¯ãƒ¦ãƒ¼ã‚¶å†è©¦è¡Œå¯èƒ½ã€‚

## 9. æ€§èƒ½/å¸¯åŸŸäºˆç®—

| é …ç›®               | ç›®æ¨™         | è¨ˆç®—æ ¹æ‹                                               |
| ------------------ | ------------ | ----------------------------------------------------- |
| Pose Packet ã‚µã‚¤ã‚º | ~180B (JSON) | id(8) + t(4) + p(3*4) + r(4*4) + head(çœç•¥å¯) + delim |
| å¹³å‡é€ä¿¡å¸¯åŸŸ       | <80kbps      | 180B \* 20Hz = 3.6KB/s -> 28.8kbps + overhead         |
| p95 åŒæœŸé…å»¶       | <=150ms      | WS RTT + server dispatch + interpolation buffer       |
| åˆæœŸãƒ­ãƒ¼ãƒ‰         | <5s          | ãƒ¢ãƒ‡ãƒ«/ãƒ†ã‚¯ã‚¹ãƒãƒ£ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ + lazy AI ãƒ‘ãƒãƒ«          |

## 10. ä¿¡é ¼æ€§/å†æ¥ç¶šæˆ¦ç•¥

- ãƒãƒƒã‚¯ã‚ªãƒ•: 0.5s,1s,2s,4s,8s,16s (æœ€å¤§ 30s cap)
- ã‚»ãƒƒã‚·ãƒ§ãƒ³å¾©å…ƒãƒˆãƒ¼ã‚¯ãƒ³: åˆå› JoinAck ã«å«ã‚ãƒ­ãƒ¼ã‚«ãƒ«ä¿æŒ (localStorage ä½¿ç”¨ã›ãšæ®ç™º: ã‚¿ãƒ–ãƒªãƒ­ãƒ¼ãƒ‰æ™‚ç ´æ£„ â†’ è¦ä»¶ FR-15 ã‚’æº€ãŸã™ãŸã‚ sessionStorage ã‚‚ä½¿ç”¨ã—ãªã„)ã€‚
- å†æ¥ç¶šæˆåŠŸå¾Œ: æ¬ æä¸­ã® AIResponse ã¯ç ´æ£„ (ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†é€ UI)ã€‚

## 11. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£/ãƒ—ãƒ©ã‚¤ãƒã‚·åˆ¶å¾¡

| é …ç›®       | å¯¾ç­–                                                                                       |
| ---------- | ------------------------------------------------------------------------------------------ |
| é€šä¿¡æš—å·åŒ– | HTTPS + WSS / WebRTC DTLS + SRTP                                                           |
| XSS        | AI çµæœè¡¨ç¤ºå‰ã« DOMPurify ç­‰ (MVP: ç°¡æ˜“ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—)                                         |
| å€‹äººæƒ…å ±   | å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: nickname(1-24), profileNote(0-140) ä»¥ä¸Šç¦æ­¢                                |
| ãƒ­ã‚°       | ã‚µãƒ¼ãƒ: join/leave/error ã®ã¿ã€‚AI å…¥åŠ›æœ¬æ–‡ã¯ãƒã‚¹ã‚¯é•· (len) ã®ã¿ä¿å­˜ (PoC ã§ã¯ãƒ­ã‚°ç„¡åŠ¹ã‚‚å¯) |

## 12. è¨­å®š (env) åˆæœŸã‚­ãƒ¼æ¡ˆ

| å¤‰æ•°                     | ç”¨é€”               | ä¾‹                      |
| ------------------------ | ------------------ | ----------------------- |
| LIVEKIT_URL              | LiveKit ã‚µãƒ¼ãƒ URL | wss://audio.example.com |
| LIVEKIT_API_KEY / SECRET | ãƒˆãƒ¼ã‚¯ãƒ³ç½²åç”¨     | \*\*\*\*                |
| AI_PROVIDER              | æŠ½è±¡ã‚¹ã‚¤ãƒƒãƒ       | openai / azure / mock   |
| AI_TIMEOUT_MS_TRANSLATE  | Timeout override   | 8000                    |
| MAX_ROOM_CAPACITY        | å‚åŠ ä¸Šé™           | 10                      |

## 13. ãƒ­ã‚°/ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚° (MVP æœ€å°)

| ã‚¤ãƒ™ãƒ³ãƒˆ       | ãƒ¬ãƒ™ãƒ« | ä¾‹                |
| -------------- | ------ | ----------------- |
| Join/Leave     | info   | playerId, count   |
| CapacityReject | warn   | requested, limit  |
| ReconnectFail  | warn   | playerId, attempt |
| AI Timeout     | error  | type, elapsedMs   |

P2: ãƒ¡ãƒˆãƒªã‚¯ã‚¹å°å…¥ (Prometheus) / p95 é€ä¿¡é…å»¶è¨ˆæ¸¬ãƒã‚±ãƒƒãƒˆã€‚

## 14. ãƒ†ã‚¹ãƒˆæˆ¦ç•¥æ¦‚è¦

| ãƒ¬ã‚¤ãƒ¤       | ãƒ†ã‚¹ãƒˆç¨®åˆ¥   | ãƒ„ãƒ¼ãƒ«                     | ç›®çš„                     |
| ------------ | ------------ | -------------------------- | ------------------------ |
| ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ | å˜ä½“         | Vitest / Jest              | è£œé–“è¨ˆç®—, ãƒ¬ãƒ¼ãƒˆåˆ¶å¾¡     |
| ã‚µãƒ¼ãƒ       | å˜ä½“         | Jest                       | Room state å¤‰æ›/å®¹é‡åˆ¶é™ |
| E2E          | å¤šäººæ•°ã‚·ãƒŸãƒ¥ | headless (Playwright + WS) | AC-01~02 ç¢ºèª            |
| è² è·         | ã‚¹ã‚¯ãƒªãƒ—ãƒˆ   | server/loadtest/example.ts | 10 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ 10 åˆ†    |
| æ€§èƒ½         | è¨ˆæ¸¬         | Web Perf API               | åˆæœŸãƒ­ãƒ¼ãƒ‰æ™‚é–“           |

## 15. ãƒªã‚¹ã‚¯ã¨æŠ€è¡“çš„ç·©å’Œ (è©³ç´°)

| ãƒªã‚¹ã‚¯          | è©³ç´°                  | ç·©å’Œ                                    |
| --------------- | --------------------- | --------------------------------------- |
| Pose ã‚¸ãƒƒã‚¿ãƒ¼   | ä¸å‡ä¸€é–“éš”å—ä¿¡        | ãƒãƒƒãƒ•ã‚¡ 50ms + è£œé–“/å¤–æŒ¿ä¸Šé™           |
| AI é«˜é…å»¶       | å¤–éƒ¨ API ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ | ä¸¦åˆ— + ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° + cancel ãƒˆãƒ¼ã‚¯ãƒ³   |
| VR ãƒ‡ãƒã‚¤ã‚¹å·®ç•° | åº§æ¨™ç³»/å‘ãé•ã„       | WebXR reference space çµ±ä¸€(local-floor) |
| éŸ³å£°å®šä½ä¸è‡ªç„¶  | ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·/æ›´æ–°é…å»¶   | rAF æ›´æ–° & Panner parameters pre-config |

## 16. å°†æ¥æ‹¡å¼µãƒã‚¤ãƒ³ãƒˆ (Interface Hooks)

- é‡å­åŒ–: `PoseEncoder` æˆ¦ç•¥ãƒ‘ã‚¿ãƒ¼ãƒ³ (raw / quantized)
- ãƒãƒ«ãƒãƒ«ãƒ¼ãƒ : `RoomService` æŠ½è±¡ + ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«
- èªè¨¼: `AuthContext` ã‚’ Join ãƒ•ãƒ­ãƒ¼ã«æŒ¿å…¥ (JWT æ¤œè¨¼)
- éŸ³å£°ãƒ†ã‚­ã‚¹ãƒˆåŒ– (STT): LiveKit Webhook â†’ Server AI Pipeline

## 17. ãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£è£œè¶³

FR/NFR ã«å¯¾ã™ã‚‹ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå¯¾å¿œã¯ Â§3 è¡¨å‚ç…§ã€‚AC ã¨ãƒ†ã‚¹ãƒˆè¨ˆç”»ã®ãƒªãƒ³ã‚¯ã¯ `development-plan.md` ã§è©³ç´°åŒ–ã€‚

## 18. å¤‰æ›´ç®¡ç†

`spec.md` ã«æº–æ‹ ã€‚ãƒ–ãƒ¬ã‚¤ã‚­ãƒ³ã‚°: ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ /å‰Šé™¤ã¯ `CHANGELOG.md` ã¨ schema version incrementã€‚

## 19. æ¬¡ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ (v0.3 æƒ³å®š)

- LiveKit ãƒ™ãƒ¼ã‚¹ã®ç©ºé–“éŸ³å£°çµ±åˆã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ Panner æ›´æ–°ãƒ«ãƒ¼ãƒ—ã®å®Ÿè£…ã€‚
- Colyseus å†æ¥ç¶šãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° (ãƒãƒƒã‚¯ã‚ªãƒ• UI, çŠ¶æ…‹å†åŒæœŸ) ã®å°å…¥ã€‚
- å‚åŠ ãƒ•ã‚©ãƒ¼ãƒ /UI ã¨è¡¨ç¤ºåã®å°å…¥ã€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ã®é€ä¿¡åˆ¶å¾¡ã€‚
- AI Gateway æŠ½è±¡ã®ã‚¹ã‚±ãƒ«ãƒˆãƒ³å®Ÿè£…ã¨ãƒ¢ãƒƒã‚¯å¿œç­”ã§ã® UI é–‹ç™ºã€‚
- ãƒªãƒ¢ãƒ¼ãƒˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã« VRM ã‚¢ãƒã‚¿ãƒ¼ã‚’é©ç”¨ã—ã€æ‰‹/é ­ãƒãƒ¼ã‚ºã®é§†å‹•ã«å¯¾å¿œã€‚

---

(End of Document)
